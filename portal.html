<html>

<head>
    <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=Cairo|Montserrat:500|Open+Sans" rel="stylesheet">
    <title>CCT - Cornell Club of Taiwan</title>
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/main.css">
    <link rel="stylesheet" type="text/css" href="slick/slick.css" />
    <link rel="stylesheet" type="text/css" href="slick/slick-theme.css" />
    <link rel="icon" href="./img/icon.ico">
</head>

<body>
    <div id="topbar">
        <div class="navbar">
            <a class="col-xs-4 col-xs-offset-0 col-sm-1 col-sm-offset-1" id="logo" href="./index.html">
                <img src="./img/logo_v2.png">
            </a>
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="./index.html">
                            <b>CORNELL CLUB of TAIWAN</b>
                        </a>
                    </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="./index.html">HOME</a>
                    </li>
                    <li>
                        <a href="./members.html">MEMBERS</a>
                    </li>
                    <li>
                        <a href="./alumni.html">ALUMNI</a>
                    </li>
                    <li>
                        <a href="./events.html">EVENTS</a>
                    </li>
                    <li>
                        <a class="active" href="./portal.html">PORTAL</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div id="portal" class="container">
        <a id="portal_login" href="#">Login</a>
        <a id="portal_logout" href="#">Logout</a>
    </div>

    <script src="./js/jquery-3.2.1.min.js"></script>
    <script src="./js/bootstrap.min.js"></script>

    <script src="https://www.gstatic.com/firebasejs/4.10.1/firebase.js"></script>
    <script>
        // Initialize Firebase
        // var config = {
        //     apiKey: "AIzaSyD5RfGoMCuLL2G7SbDK-OBGnJo18VuS2dQ",
        //     authDomain: "cct-website-196921.firebaseapp.com",
        //     databaseURL: "https://cct-website-196921.firebaseio.com",
        //     projectId: "cct-website-196921",
        //     storageBucket: "cct-website-196921.appspot.com",
        //     messagingSenderId: "270090804928"
        // };
        // firebase.initializeApp(config);

        // var provider = new firebase.auth.GoogleAuthProvider();

        // $("#portal_login").click(function () {
        //     firebase.auth().signInWithPopup(provider).then(function (result) {
        //         var token = result.credential.accessToken;
        //         var user = result.user;
        //         console.log(user);
        //         $("#portal").html("<div>Logged in as " + user.email + ". Portal will be updated soon.</div>")
        //         // ...
        //     }).catch(function (error) {
        //         // Handle Errors here.
        //         var errorCode = error.code;
        //         var errorMessage = error.message;
        //         var email = error.email;
        //         var credential = error.credential;
        //     });
        // })

        var CLIENT_ID = '270090804928-fisc4vgsdic7oj2r6valjmn58sir8a4u.apps.googleusercontent.com';
        var API_KEY = 'AIzaSyCMs99x075GStFbTCYNIVlp_yEzvrl6Rl0';

        var DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];
        var SCOPES = "https://www.googleapis.com/auth/spreadsheets.readonly";

        var authorizeButton = document.getElementById('portal_login');
        var signoutButton = document.getElementById('portal_logout');

        /**
         *  On load, called to load the auth2 library and API client library.
         */
        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        /**
         *  Initializes the API client library and sets up sign-in state
         *  listeners.
         */
        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                discoveryDocs: DISCOVERY_DOCS,
                scope: SCOPES
            }).then(function () {
                gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
                updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
                authorizeButton.onclick = handleAuthClick;
                signoutButton.onclick = handleSignoutClick;
            });
        }

        function updateSigninStatus(isSignedIn) {
            if (isSignedIn) {
                authorizeButton.style.display = 'none';
                signoutButton.style.display = 'block';
                listMajors();
            } else {
                authorizeButton.style.display = 'block';
                signoutButton.style.display = 'none';
            }
        }

        function handleAuthClick(event) {
            gapi.auth2.getAuthInstance().signIn();
        }

        function handleSignoutClick(event) {
            gapi.auth2.getAuthInstance().signOut();
        }

        function listMajors() {
            gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: '17Tvy1XGvgBUVRhPPc_7qgDdrYS8Iq7uPuNl-Wor83J4',
                range: 'Class Data!A2:E',
            }).then(function (response) {
                var range = response.result;
                if (range.values.length > 0) {
                    console.log(range)
                } else {
                    console.log("no data")
                }
            }, function (response) {
                appendPre('Error: ' + response.result.error.message);
            });
        }

    </script>
    <script async defer src="https://apis.google.com/js/api.js"
    onload="this.onload=function(){};handleClientLoad()"
    onreadystatechange="if (this.readyState === 'complete') this.onload()">
  </script>
</body>
<footer>
    <a class="col-xs-2 col-xs-offset-4 col-md-1 col-md-offset-5" href="mailto:cornellclub.taiwan@gmail.com">
        <img src="./img/email.svg">
    </a>
    <a class="col-xs-2 col-md-1" href="https://www.facebook.com/CornellClubOfTaiwan" target="_newtab">
        <img src="./img/fb.svg">
    </a>
</footer>

</html>